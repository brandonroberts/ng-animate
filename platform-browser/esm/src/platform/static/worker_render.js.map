{"version":3,"file":"worker_render.js","sourceRoot":"","sources":["../../../../../../../modules/@angular/platform-browser/src/platform/static/worker_render.ts"],"names":[],"mappings":"OAAO,EACL,cAAc,EACd,kBAAkB,EAClB,oBAAoB,EACrB,MAAM,2CAA2C;OAC3C,EAAC,UAAU,EAAC,MAAM,sCAAsC;OACxD,EAAC,QAAQ,EAAE,UAAU,EAAE,eAAe,EAAC,MAAM,eAAe;OAC5D,EACL,0CAA0C,EAC1C,aAAa,EACb,+BAA+B,EAChC,MAAM,yBAAyB;OACzB,EAAC,aAAa,EAAC,MAAM,gCAAgC;OAGrD,EAAC,SAAS,EAAC,MAAM,mBAAmB;OACpC,EAAC,cAAc,EAAC,MAAM,oBAAoB;OAC1C,EACL,cAAc,EACd,kBAAkB,EACnB,MAAM,eAAe;OACf,EAAC,oBAAoB,EAAC,MAAM,yBAAyB;AAC5D;IAIE,gBAAgB;IACT,IAAI,CAAC,MAAc,EAAE,GAAe;QACzC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;IACjB,CAAC;AAIH,CAAC;AAHM,4BAAU,GAA0B;IAC3C,EAAE,IAAI,EAAE,UAAU,EAAE;CACnB,CACA;AAED;;GAEG;AACH,OAAO,MAAM,0CAA0C,GAA6D;IAClH,0CAA0C,EAAE,iBAAiB;IAC7D,qBAAqB,CAAC;QACpB,OAAO,EAAE,eAAe;QACxB,UAAU,EAAE,CAAC,QAAQ,IAAI,MAAM,wBAAwB,CAAC,QAAQ,CAAC,CAAC;QAClE,KAAK,EAAE,IAAI;QACX,IAAI,EAAE,CAAC,QAAQ,CAAC;KACjB;IACD,qBAAqB,CAAC;QACpB,OAAO,EAAE,UAAU;QACnB,UAAU,EAAE,CAAC,QAAQ,KAAK,QAAQ,CAAC,GAAG;QACtC,IAAI,EAAE,CAAC,iBAAiB,CAAC;KAC1B;CACF,CAAC;AAEF,sCACE,eAAuB,EACvB,eAAwD;IACxD,IAAI,GAAG,GAAG,kBAAkB,CAAC,gBAAgB,CAC3C;QACE,0CAA0C;QAC1C,uBAAuB,CAAC,EAAC,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,eAAe,EAAC;QAC3E,SAAS,CAAC,eAAe,CAAC,GAAG,eAAe,GAAG,EAAE;KAClD,EACD,oBAAoB,EAAE,CAAC,QAAQ,CAAC,CAAC;IACnC,+DAA+D;IAC/D,wDAAwD;IACxD,mBAAmB;IACnB,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;AACzD,CAAC;AAGD,kCAAkC,QAAkB;IAClD,IAAI,SAAiB,CAAC;IACtB,IAAI,CAAC;QACH,SAAS,GAAG,QAAQ,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;IAC1C,CAAE;IAAA,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACX,MAAM,IAAI,aAAa,CACnB,sFAAsF,CAAC,CAAC;IAC9F,CAAC;IAED,IAAI,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;IAC/C,cAAc,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;IAEpC,+BAA+B,CAAC,QAAQ,CAAC,CAAC;AAC5C,CAAC;AAED;;GAEG;AACH,wBAAwB,GAAW,EAAE,QAA2B;IAC9D,IAAI,SAAS,GAAW,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC;IACxC,IAAI,IAAI,GAAG,IAAI,kBAAkB,CAAC,SAAS,CAAC,CAAC;IAC7C,IAAI,MAAM,GAAG,IAAI,oBAAoB,CAAC,SAAS,CAAC,CAAC;IACjD,IAAI,GAAG,GAAG,IAAI,cAAc,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IAE3C,QAAQ,CAAC,IAAI,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;AAChC,CAAC","sourcesContent":["import {\n  PostMessageBus,\n  PostMessageBusSink,\n  PostMessageBusSource\n} from '../../web_workers/shared/post_message_bus';\nimport {MessageBus} from '../../web_workers/shared/message_bus';\nimport {Injector, Injectable, APP_INITIALIZER} from '@angular/core';\nimport {\n  WORKER_RENDER_APPLICATION_COMMON_PROVIDERS,\n  WORKER_SCRIPT,\n  initializeGenericWorkerRenderer\n} from '../common/worker_render';\nimport {BaseException} from '../../../src/facade/exceptions';\n\n\nimport {isPresent} from '../../facade/lang';\nimport {PromiseWrapper} from '../../facade/async';\nimport {\n  ApplicationRef,\n  ReflectiveInjector,\n} from '@angular/core';\nimport {workerRenderPlatform} from '../common/worker_render';\nexport class WebWorkerInstance {\n  public worker: Worker;\n  public bus: MessageBus;\n\n  /** @internal */\n  public init(worker: Worker, bus: MessageBus) {\n    this.worker = worker;\n    this.bus = bus;\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n}\n\n/**\n * An array of providers that should be passed into `application()` when initializing a new Worker.\n */\nexport const WORKER_RENDER_STATIC_APPLICATION_PROVIDERS: Array<any /*Type | Provider | any[]*/> = /*@ts2dart_const*/[\n  WORKER_RENDER_APPLICATION_COMMON_PROVIDERS, WebWorkerInstance,\n  /*@ts2dart_Provider*/ {\n    provide: APP_INITIALIZER,\n    useFactory: (injector => () => initWebWorkerApplication(injector)),\n    multi: true,\n    deps: [Injector]\n  },\n  /*@ts2dart_Provider*/ {\n    provide: MessageBus,\n    useFactory: (instance) => instance.bus,\n    deps: [WebWorkerInstance]\n  }\n];\n\nexport function bootstrapStaticRender(\n  workerScriptUri: string,\n  customProviders?: Array<any /*Type | Provider | any[]*/>): Promise<ApplicationRef> {\n  var app = ReflectiveInjector.resolveAndCreate(\n    [\n      WORKER_RENDER_STATIC_APPLICATION_PROVIDERS,\n      /* @ts2dart_Provider */ {provide: WORKER_SCRIPT, useValue: workerScriptUri},\n      isPresent(customProviders) ? customProviders : []\n    ],\n    workerRenderPlatform().injector);\n  // Return a promise so that we keep the same semantics as Dart,\n  // and we might want to wait for the app side to come up\n  // in the future...\n  return PromiseWrapper.resolve(app.get(ApplicationRef));\n}\n\n\nfunction initWebWorkerApplication(injector: Injector): void {\n  var scriptUri: string;\n  try {\n    scriptUri = injector.get(WORKER_SCRIPT);\n  } catch (e) {\n    throw new BaseException(\n        \"You must provide your WebWorker's initialization script with the WORKER_SCRIPT token\");\n  }\n\n  let instance = injector.get(WebWorkerInstance);\n  spawnWebWorker(scriptUri, instance);\n\n  initializeGenericWorkerRenderer(injector);\n}\n\n/**\n * Spawns a new class and initializes the WebWorkerInstance\n */\nfunction spawnWebWorker(uri: string, instance: WebWorkerInstance): void {\n  var webWorker: Worker = new Worker(uri);\n  var sink = new PostMessageBusSink(webWorker);\n  var source = new PostMessageBusSource(webWorker);\n  var bus = new PostMessageBus(sink, source);\n\n  instance.init(webWorker, bus);\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}