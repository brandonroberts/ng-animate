{"version":3,"file":"worker_render.js","sourceRoot":"","sources":["../../../../../../../modules/@angular/platform-browser/src/platform/common/worker_render.ts"],"names":[],"mappings":"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","sourcesContent":["import {isBlank} from \"../../../src/facade/lang\";\nimport {MessageBus} from \"../../web_workers/shared/message_bus\";\nimport {\n  NgZone,\n  Injector,\n  OpaqueToken,\n  Testability,\n  ExceptionHandler,\n  APPLICATION_COMMON_PROVIDERS,\n  PLATFORM_COMMON_PROVIDERS,\n  RootRenderer,\n  PLATFORM_INITIALIZER,\n  PlatformRef,\n  getPlatform,\n  createPlatform,\n  assertPlatform,\n  ReflectiveInjector\n} from \"@angular/core\";\nimport {wtfInit} from \"../../../core_private\";\nimport {getDOM} from \"../../dom/dom_adapter\";\nimport {DomEventsPlugin} from \"../../dom/events/dom_events\";\nimport {KeyEventsPlugin} from \"../../dom/events/key_events\";\nimport {HammerGesturesPlugin, HAMMER_GESTURE_CONFIG, HammerGestureConfig} from \"../../dom/events/hammer_gestures\";\nimport {DOCUMENT} from \"../../dom/dom_tokens\";\nimport {DomRootRenderer, DomRootRenderer_} from \"../../dom/dom_renderer\";\nimport {DomSharedStylesHost, SharedStylesHost} from \"../../dom/shared_styles_host\";\nimport {BrowserDetails} from \"../../animate/browser_details\";\nimport {AnimationBuilder} from \"../../animate/animation_builder\";\nimport {BrowserGetTestability} from \"../../browser/testability\";\nimport {BrowserDomAdapter} from \"../../browser/browser_adapter\";\nimport {MessageBasedRenderer} from \"../../web_workers/ui/renderer\";\nimport {\n  ServiceMessageBrokerFactory,\n  ServiceMessageBrokerFactory_\n} from \"../../web_workers/shared/service_message_broker\";\nimport {ClientMessageBrokerFactory, ClientMessageBrokerFactory_} from \"../../web_workers/shared/client_message_broker\";\nimport {Serializer} from \"../../web_workers/shared/serializer\";\nimport {ON_WEB_WORKER} from \"../../web_workers/shared/api\";\nimport {RenderStore} from \"../../web_workers/shared/render_store\";\nimport {EventManager, EVENT_MANAGER_PLUGINS} from \"../../dom/events/event_manager\";\nimport {BROWSER_SANITIZATION_PROVIDERS} from \"../common/browser\";\n\nconst WORKER_RENDER_PLATFORM_MARKER =\n  /*@ts2dart_const*/ new OpaqueToken('WorkerRenderPlatformMarker');\n\nexport const WORKER_SCRIPT: OpaqueToken = /*@ts2dart_const*/ new OpaqueToken(\"WebWorkerScript\");\n\n/**\n * A multiple providers used to automatically call the `start()` method after the service is\n * created.\n *\n * TODO(vicb): create an interface for startable services to implement\n */\nexport const WORKER_RENDER_STARTABLE_MESSAGING_SERVICE =\n    /*@ts2dart_const*/ new OpaqueToken('WorkerRenderStartableMsgService');\n\nexport const WORKER_RENDER_PLATFORM_PROVIDERS: Array<any /*Type | Provider | any[]*/> = /*@ts2dart_const*/[\n  PLATFORM_COMMON_PROVIDERS,\n  /*@ts2dart_const*/ (/* @ts2dart_Provider */ {provide: WORKER_RENDER_PLATFORM_MARKER, useValue: true}),\n  /* @ts2dart_Provider */ {provide: PLATFORM_INITIALIZER, useValue: initWebWorkerRenderPlatform, multi: true}\n];\n\nexport const WORKER_RENDER_APPLICATION_COMMON_PROVIDERS: Array<any /*Type | Provider | any[]*/> =\n    /*@ts2dart_const*/[\n      APPLICATION_COMMON_PROVIDERS,\n      MessageBasedRenderer,\n      /* @ts2dart_Provider */ {provide: WORKER_RENDER_STARTABLE_MESSAGING_SERVICE, useExisting: MessageBasedRenderer, multi: true},\n      BROWSER_SANITIZATION_PROVIDERS,\n      /* @ts2dart_Provider */ {provide: ExceptionHandler, useFactory: _exceptionHandler, deps: []},\n      /* @ts2dart_Provider */ {provide: DOCUMENT, useFactory: _document, deps: []},\n      // TODO(jteplitz602): Investigate if we definitely need EVENT_MANAGER on the render thread\n      // #5298\n      /* @ts2dart_Provider */ {provide: EVENT_MANAGER_PLUGINS, useClass: DomEventsPlugin, multi: true},\n      /* @ts2dart_Provider */ {provide: EVENT_MANAGER_PLUGINS, useClass: KeyEventsPlugin, multi: true},\n      /* @ts2dart_Provider */ {provide: EVENT_MANAGER_PLUGINS, useClass: HammerGesturesPlugin, multi: true},\n      /* @ts2dart_Provider */ {provide: HAMMER_GESTURE_CONFIG, useClass: HammerGestureConfig},\n      /* @ts2dart_Provider */ {provide: DomRootRenderer, useClass: DomRootRenderer_},\n      /* @ts2dart_Provider */ {provide: RootRenderer, useExisting: DomRootRenderer},\n      /* @ts2dart_Provider */ {provide: SharedStylesHost, useExisting: DomSharedStylesHost},\n      /* @ts2dart_Provider */ {provide: ServiceMessageBrokerFactory, useClass: ServiceMessageBrokerFactory_},\n      /* @ts2dart_Provider */ {provide: ClientMessageBrokerFactory, useClass: ClientMessageBrokerFactory_},\n      Serializer,\n      /* @ts2dart_Provider */ {provide: ON_WEB_WORKER, useValue: false},\n      RenderStore,\n      DomSharedStylesHost,\n      Testability,\n      BrowserDetails,\n      AnimationBuilder,\n      EventManager\n    ];\n\nexport function initializeGenericWorkerRenderer(injector: Injector) {\n  var bus = injector.get(MessageBus);\n  let zone = injector.get(NgZone);\n  bus.attachToZone(zone);\n\n  // initialize message services after the bus has been created\n  let services = injector.get(WORKER_RENDER_STARTABLE_MESSAGING_SERVICE);\n  zone.runGuarded(() => { services.forEach((svc) => { svc.start(); }); });\n}\n\nfunction initWebWorkerRenderPlatform(): void {\n  BrowserDomAdapter.makeCurrent();\n  wtfInit();\n  BrowserGetTestability.init();\n}\n\nexport function workerRenderPlatform(): PlatformRef {\n  if (isBlank(getPlatform())) {\n    createPlatform(ReflectiveInjector.resolveAndCreate(WORKER_RENDER_PLATFORM_PROVIDERS));\n  }\n  return assertPlatform(WORKER_RENDER_PLATFORM_MARKER);\n}\n\nfunction _exceptionHandler(): ExceptionHandler {\n  return new ExceptionHandler(getDOM());\n}\n\nfunction _document(): any {\n  return getDOM().defaultDoc();\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}