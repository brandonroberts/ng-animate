{"version":3,"file":"animation_compiler.js","sourceRoot":"","sources":["../../../../../../modules/@angular/compiler/src/animation/animation_compiler.ts"],"names":[],"mappings":"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","sourcesContent":["import {BaseException} from '../facade/exceptions';\nimport {ListWrapper, Map, StringMapWrapper} from '../facade/collection';\nimport {isPresent, isBlank, isArray} from '../facade/lang';\n\nimport {Identifiers} from '../identifiers';\nimport * as o from '../output/output_ast';\n\nimport {AUTO_STYLE} from '@angular/core';\nimport {ANY_STATE, EMPTY_STATE} from '../../core_private';\n\nimport {\n  AnimationParseError,\n  ParsedAnimationResult,\n  parseAnimationEntry\n} from './animation_parser';\n\nimport {CompileDirectiveMetadata} from \"../compile_metadata\";\n\nimport {\n  AnimationAst,\n  AnimationEntryAst,\n  AnimationStateAst,\n  AnimationStateDeclarationAst,\n  AnimationStateTransitionAst,\n  AnimationKeyframeAst,\n  AnimationStylesAst,\n  AnimationSequenceAst,\n  AnimationGroupAst,\n  AnimationStepAst,\n  AnimationAstVisitor\n} from './animation_ast';\n\nexport class CompiledAnimation {\n  constructor(public name: string,\n              public statesMapStatement: o.Statement,\n              public statesVariableName: string,\n              public fnStatement: o.Statement,\n              public fnVariable: o.Expression) {}\n}\n\nexport class AnimationCompiler {\n  compileComponent(component: CompileDirectiveMetadata): CompiledAnimation[] {\n    var compiledAnimations: CompiledAnimation[] = [];\n    var index = 0;\n    component.template.animations.forEach(entry => {\n      var result = parseAnimationEntry(entry);\n      if (result.errors.length > 0) {\n        var errorMessage = '';\n        result.errors.forEach((error: AnimationParseError) => { errorMessage += \"\\n- \" + error.msg; });\n        // todo (matsko): include the component name when throwing\n        throw new BaseException(\n          `Unable to parse the animation sequence for \"${entry.name}\" due to the following errors: ` +\n          errorMessage);\n      }\n\n      var factoryName = `${component.type.name}_${entry.name}_${index}`;\n      index++;\n\n      var visitor = new _AnimationBuilder(entry.name, factoryName);\n      compiledAnimations.push(visitor.build(result.ast));\n    });\n    return compiledAnimations;\n  }\n}\n\nvar _ANIMATION_FACTORY_ELEMENT_VAR = o.variable('element');\nvar _ANIMATION_FACTORY_VIEW_VAR = o.variable('view');\nvar _ANIMATION_FACTORY_RENDERER_VAR = _ANIMATION_FACTORY_VIEW_VAR.prop('renderer');\nvar _ANIMATION_CURRENT_STATE_VAR = o.variable('currentState');\nvar _ANIMATION_NEXT_STATE_VAR = o.variable('nextState');\nvar _ANIMATION_PLAYER_VAR = o.variable('player');\nvar _ANIMATION_START_STATE_STYLES_VAR = o.variable('startStateStyles');\nvar _ANIMATION_END_STATE_STYLES_VAR = o.variable('endStateStyles');\nvar _ANIMATION_COLLECTED_STYLES = o.variable('collectedStyles');\nvar EMPTY_MAP = o.literalMap([]);\n\nclass _AnimationBuilder implements AnimationAstVisitor {\n  private _fnVarName: string;\n  private _statesMapVarName: string;\n  private _statesMapVar: any;\n\n  constructor(public animationName: string, factoryName: string) {\n    this._fnVarName = factoryName + '_factory';\n    this._statesMapVarName = factoryName + '_states';\n    this._statesMapVar = o.variable(this._statesMapVarName);\n  }\n\n  visitAnimationStyles(ast: AnimationStylesAst,\n                       context: _AnimationBuilderContext): o.Expression {\n    var stylesArr = [];\n    if (context.isExpectingFirstStyleStep) {\n      stylesArr.push(_ANIMATION_START_STATE_STYLES_VAR);\n      context.isExpectingFirstStyleStep = false;\n    }\n\n    ast.styles.forEach(entry => {\n      stylesArr.push(o.literalMap(StringMapWrapper.keys(entry).map(key => [key, o.literal(entry[key])])));\n    });\n\n    return o.importExpr(Identifiers.AnimationStyles).instantiate([\n      o.importExpr(Identifiers.collectAndResolveStyles).callFn([\n        _ANIMATION_COLLECTED_STYLES,\n        o.literalArr(stylesArr)\n      ])\n    ]);\n  }\n\n  visitAnimationKeyframe(ast: AnimationKeyframeAst,\n                         context: _AnimationBuilderContext): o.Expression {\n    return o.importExpr(Identifiers.AnimationKeyframe).instantiate([\n      o.literal(ast.offset),\n      ast.styles.visit(this, context)\n    ]);\n  }\n\n  visitAnimationStep(ast: AnimationStepAst, context: _AnimationBuilderContext): o.Expression {\n    if (context.endStateAnimateStep === ast) {\n      return this._visitEndStateAnimation(ast, context);\n    }\n\n    var startingStylesExpr = ast.startingStyles.visit(this, context);\n    var keyframeExpressions = ast.keyframes.map(keyframeEntry => keyframeEntry.visit(this, context));\n    return this._callAnimateMethod(ast, startingStylesExpr, o.literalArr(keyframeExpressions));\n  }\n\n  _visitEndStateAnimation(ast: AnimationStepAst,\n                            context: _AnimationBuilderContext): o.Expression {\n    var startingStylesExpr = ast.startingStyles.visit(this, context);\n    var keyframeExpressions = ast.keyframes.map(keyframe => keyframe.visit(this, context));\n    var keyframesExpr = o.importExpr(Identifiers.balanceAnimationKeyframes).callFn([\n      _ANIMATION_COLLECTED_STYLES,\n      _ANIMATION_END_STATE_STYLES_VAR,\n      o.literalArr(keyframeExpressions)\n    ]);\n\n    return this._callAnimateMethod(ast, startingStylesExpr, keyframesExpr);\n  }\n\n  _callAnimateMethod(ast: AnimationStepAst, startingStylesExpr, keyframesExpr) {\n    return _ANIMATION_FACTORY_RENDERER_VAR.callMethod('animate', [\n      _ANIMATION_FACTORY_ELEMENT_VAR,\n      startingStylesExpr,\n      keyframesExpr,\n      o.literal(ast.duration),\n      o.literal(ast.delay),\n      o.literal(ast.easing)\n    ]);\n  }\n\n  visitAnimationSequence(ast: AnimationSequenceAst,\n                         context: _AnimationBuilderContext): o.Expression {\n    var playerExprs = ast.steps.map(step => step.visit(this, context));\n    return o.importExpr(Identifiers.AnimationSequencePlayer).instantiate([\n      o.literalArr(playerExprs)]);\n  }\n\n  visitAnimationGroup(ast: AnimationGroupAst, context: _AnimationBuilderContext): o.Expression {\n    var playerExprs = ast.steps.map(step => step.visit(this, context));\n    return o.importExpr(Identifiers.AnimationGroupPlayer).instantiate([\n      o.literalArr(playerExprs)]);\n  }\n\n  visitAnimationStateDeclaration(ast: AnimationStateDeclarationAst, context: _AnimationBuilderContext): void {\n    var flatStyles: {[key: string]: string|number} = {};\n    _getStylesArray(ast).forEach(entry => {\n      StringMapWrapper.forEach(entry, (value, key) => {\n        flatStyles[key] = value;\n      });\n    });\n    context.stateMap.registerState(ast.stateName, flatStyles);\n  }\n\n  visitAnimationStateTransition(ast: AnimationStateTransitionAst, context: _AnimationBuilderContext): any {\n    var steps = ast.animation.steps;\n    var lastStep = steps[steps.length - 1];\n    if (_isEndStateAnimateStep(lastStep)) {\n      context.endStateAnimateStep = <AnimationStepAst>lastStep;\n    }\n\n    context.isExpectingFirstStyleStep = true;\n\n    var stateChangePreconditions = [];\n\n    ast.stateChanges.forEach(stateChange => {\n      stateChangePreconditions.push(\n        _compareToAnimationStateExpr(_ANIMATION_CURRENT_STATE_VAR, stateChange.fromState)\n        .and(_compareToAnimationStateExpr(_ANIMATION_NEXT_STATE_VAR, stateChange.toState))\n      );\n\n      if (stateChange.fromState != ANY_STATE) {\n        context.stateMap.registerState(stateChange.fromState);\n      }\n\n      if (stateChange.toState != ANY_STATE) {\n        context.stateMap.registerState(stateChange.toState);\n      }\n    });\n\n    var animationPlayerExpr = ast.animation.visit(this, context);\n\n    var reducedStateChangesPrecondition = stateChangePreconditions.reduce((a,b) => a.or(b));\n    var precondition = _ANIMATION_PLAYER_VAR.equals(o.NULL_EXPR).and(reducedStateChangesPrecondition);\n\n    return new o.IfStmt(precondition, [\n      _ANIMATION_PLAYER_VAR.set(animationPlayerExpr).toStmt()\n    ]);\n  }\n\n  visitAnimationEntry(ast: AnimationEntryAst, context: _AnimationBuilderContext): any {\n    //visit each of the declarations first to build the context state map\n    ast.stateDeclarations.forEach(def => def.visit(this, context));\n\n    var statements = [];\n    statements.push(\n      _ANIMATION_FACTORY_VIEW_VAR.callMethod('cancelActiveAnimation', [\n        _ANIMATION_FACTORY_ELEMENT_VAR,\n        o.literal(this.animationName),\n        _ANIMATION_NEXT_STATE_VAR.equals(o.literal(EMPTY_STATE))\n      ]).toStmt());\n\n    statements.push(_ANIMATION_COLLECTED_STYLES.set(EMPTY_MAP).toDeclStmt());\n    statements.push(_ANIMATION_PLAYER_VAR.set(o.NULL_EXPR).toDeclStmt());\n\n    statements.push(\n      _ANIMATION_START_STATE_STYLES_VAR.set(\n        this._statesMapVar.key(_ANIMATION_CURRENT_STATE_VAR)\n      ).toDeclStmt());\n\n    statements.push(\n      new o.IfStmt(_ANIMATION_START_STATE_STYLES_VAR.equals(o.NULL_EXPR), [\n        _ANIMATION_START_STATE_STYLES_VAR.set(EMPTY_MAP).toStmt()\n      ]));\n\n    statements.push(\n      _ANIMATION_END_STATE_STYLES_VAR.set(\n        this._statesMapVar.key(_ANIMATION_NEXT_STATE_VAR)\n      ).toDeclStmt());\n\n    statements.push(\n      new o.IfStmt(_ANIMATION_END_STATE_STYLES_VAR.equals(o.NULL_EXPR), [\n        _ANIMATION_END_STATE_STYLES_VAR.set(EMPTY_MAP).toStmt()\n      ]));\n\n    // before we start any animation we want to clear out the starting\n    // styles from the element's style property (since they were placed\n    // there at the end of the last animation\n    statements.push(\n      _ANIMATION_FACTORY_RENDERER_VAR.callMethod('setElementStyles', [\n        _ANIMATION_FACTORY_ELEMENT_VAR,\n        o.importExpr(Identifiers.clearAnimationStyles).callFn([_ANIMATION_START_STATE_STYLES_VAR])\n      ]).toStmt());\n\n    ast.stateTransitions.forEach(transAst => statements.push(transAst.visit(this, context)));\n\n    // this check ensures that the animation factory always returns a player\n    // so that the onDone callback can be used for tracking\n    statements.push(\n      new o.IfStmt(_ANIMATION_PLAYER_VAR.equals(o.NULL_EXPR), [\n        _ANIMATION_PLAYER_VAR.set(\n          o.importExpr(Identifiers.NoOpAnimationPlayer).instantiate([])\n        ).toStmt()\n      ]));\n\n    // once complete we want to apply the styles on the element\n    // since the destination state's values should persist once\n    // the animation sequence has completed.\n    statements.push(\n      _ANIMATION_PLAYER_VAR.callMethod('onDone', [\n        o.fn([], [\n          _ANIMATION_FACTORY_RENDERER_VAR.callMethod('setElementStyles', [\n            _ANIMATION_FACTORY_ELEMENT_VAR,\n            o.importExpr(Identifiers.balanceAnimationStyles).callFn([\n              _ANIMATION_START_STATE_STYLES_VAR,\n              _ANIMATION_END_STATE_STYLES_VAR\n            ])\n          ]).toStmt()\n        ])\n      ]).toStmt());\n\n    statements.push(\n      _ANIMATION_FACTORY_VIEW_VAR.callMethod('registerAndStartAnimation', [\n        _ANIMATION_FACTORY_ELEMENT_VAR,\n        o.literal(this.animationName),\n        _ANIMATION_PLAYER_VAR\n      ]).toStmt());\n\n    return o.fn([\n      new o.FnParam(_ANIMATION_FACTORY_VIEW_VAR.name, o.importType(Identifiers.AppView)),\n      new o.FnParam(_ANIMATION_FACTORY_ELEMENT_VAR.name, o.DYNAMIC_TYPE),\n      new o.FnParam(_ANIMATION_CURRENT_STATE_VAR.name, o.DYNAMIC_TYPE),\n      new o.FnParam(_ANIMATION_NEXT_STATE_VAR.name, o.DYNAMIC_TYPE)\n    ], statements);\n  }\n\n  build(ast: AnimationAst): CompiledAnimation {\n    var context = new _AnimationBuilderContext();\n    var fnStatement = ast.visit(this, context).toDeclStmt(this._fnVarName);\n    var fnVariable = o.variable(this._fnVarName);\n\n    var lookupMap = [];\n    StringMapWrapper.forEach(context.stateMap.states, (value, stateName) => {\n      var variableValue = EMPTY_MAP;\n      if (isPresent(value)) {\n        let styleMap = [];\n        StringMapWrapper.forEach(value, (value, key) => {\n          styleMap.push([key, o.literal(value)]);\n        });\n        variableValue = o.literalMap(styleMap);\n      }\n      lookupMap.push([stateName, variableValue]);\n    });\n\n    var compiledStatesMapExpr = this._statesMapVar.set(o.literalMap(lookupMap)).toDeclStmt();\n    return new CompiledAnimation(this.animationName,\n                                 compiledStatesMapExpr,\n                                 this._statesMapVarName,\n                                 fnStatement,\n                                 fnVariable);\n  }\n}\n\nclass _AnimationBuilderContext {\n  stateMap = new _AnimationBuilderStateMap();\n  endStateAnimateStep: AnimationStepAst = null;\n  isExpectingFirstStyleStep = false;\n}\n\nclass _AnimationBuilderStateMap {\n  private _states: {[key: string]: {[prop: string]: string|number}} = {};\n  get states() { return this._states; }\n  registerState(name: string, value: {[prop: string]: string|number} = null): void {\n    var existingEntry = this._states[name];\n    if (isBlank(existingEntry)) {\n      this._states[name] = value;\n    }\n  }\n}\n\nfunction _compareToAnimationStateExpr(value: o.Expression, animationState: string): o.Expression {\n  var emptyStateLiteral = o.literal(EMPTY_STATE);\n  switch (animationState) {\n    case EMPTY_STATE:\n      return value.equals(emptyStateLiteral);\n\n    case ANY_STATE:\n      return o.literal(true);\n\n    default:\n      return value.equals(o.literal(animationState));\n  }\n}\n\nfunction _isEndStateAnimateStep(step: AnimationAst): boolean {\n  // the final animation step is characterized by having only TWO\n  // keyframe values and it must have zero styles for both keyframes\n  if (step instanceof AnimationStepAst\n      && step.duration > 0\n      && step.keyframes.length == 2) {\n    var styles1 = _getStylesArray(step.keyframes[0])[0];\n    var styles2 = _getStylesArray(step.keyframes[1])[0];\n    return StringMapWrapper.isEmpty(styles1) && StringMapWrapper.isEmpty(styles2);\n  }\n  return false;\n}\n\nfunction _getStylesArray(obj: any) {\n  return obj.styles.styles;\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}